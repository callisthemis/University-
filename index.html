<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>MyStudies+ (PWA)</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#0b0d10" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />

  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Κάλυμμα όταν είσαι αποσυνδεδεμένος -->
  <section id="lockedCover" hidden>
    <div class="cover-card">
      <div class="cover-title">MyStudies+ 🔒</div>
      <p class="muted">Η εφαρμογή είναι κλειδωμένη. Πάτησε «Είσοδος» και δώσε το PIN σου.</p>
      <button id="unlockBtn" class="primary">Είσοδος</button>
    </div>
  </section>

  <header class="appbar">
    <h1>MyStudies+ <span class="lock">🔒</span></h1>
    <button id="menuBtn" class="avatar-btn" aria-label="Μενού προφίλ">
      <img id="avatarImg" alt="Εικόνα προφίλ" />
      <span id="avatarFallback" class="avatar-fallback" aria-hidden="true">?</span>
    </button>
  </header>

  <main id="app">
    <!-- Κάρτα φοιτητή -->
    <section class="card">
      <div class="student-header">
        <div>
          <div id="fullName" class="title"></div>
          <div id="university" class="subtitle"></div>
          <div id="studentId"
               class="student-id"
               title="Τριπλό tap για κρυφό editor">
            Α.Μ.: —
          </div>
        </div>
      </div>
    </section>

    <!-- Σύνοψη -->
    <section id="gpaCard" class="card">
      <h2>Σύνοψη</h2>
      <div class="row">
        <div><strong>Σταθμισμένος Μ.Ο. (ECTS):</strong></div>
        <div id="weightedGPA" class="mono">—</div>
      </div>
      <div class="row">
        <div><strong>Σύνολο ECTS:</strong></div>
        <div id="totalECTS" class="mono">—</div>
      </div>
    </section>

    <!-- Αναλύσεις -->
    <section id="analyticsCard" class="card">
      <h2>Αναλύσεις</h2>
      <div class="chart-block">
        <h3>Μ.Ο. ανά Εξάμηνο</h3>
        <canvas id="gpaLine"></canvas>
      </div>
      <div class="chart-block">
        <h3>ECTS: Πέρασε vs Απέτυχε</h3>
        <canvas id="ectsStacked"></canvas>
      </div>
    </section>

    <!-- Εξάμηνα + ανά εξάμηνο chart -->
    <div id="semesters"></div>
  </main>

  <!-- Μενού προφίλ -->
  <dialog id="menuDialog">
    <form method="dialog" class="dialog-form menu">
      <header class="menu-header">
        <div class="menu-avatar">
          <img id="menuAvatarImg" alt="Εικόνα προφίλ" />
          <span id="menuAvatarFallback" class="avatar-fallback">?</span>
        </div>
        <div class="menu-name" id="menuName">—</div>
        <button value="cancel" class="ghost small-btn">Κλείσιμο</button>
      </header>

      <nav class="menu-tabs">
        <button type="button" class="tab active" data-tab="profile">Το προφίλ μου</button>
        <button type="button" class="tab" data-tab="settings">Ρυθμίσεις</button>
      </nav>

      <section id="tab-profile" class="tab-panel active">
        <div class="grid">
          <label>Φωτογραφία προφίλ
            <input id="avatarFile" type="file" accept="image/*" />
          </label>
          <div class="hint muted">Η εικόνα αποθηκεύεται τοπικά στη συσκευή σου.</div>
        </div>
        <div class="grid">
          <label>Όνομα
            <input id="profileFirstName" type="text" />
          </label>
          <label>Επώνυμο
            <input id="profileLastName" type="text" />
          </label>
        </div>
        <div class="grid">
          <label>Πανεπιστήμιο/Τμήμα
            <input id="profileUniversity" type="text" />
          </label>
          <label>Αριθμός Μητρώου
            <input id="profileStudentId" type="text" />
          </label>
        </div>
        <menu>
          <button id="saveProfileBtn" class="primary">Αποθήκευση αλλαγών</button>
        </menu>
      </section>

      <section id="tab-settings" class="tab-panel">
        <div class="grid">
          <label>Αλλαγή PIN (προαιρετικό)
            <input id="newPinFromMenu" type="password" inputmode="numeric" maxlength="8" placeholder="Νέο PIN" />
          </label>
        </div>
        <menu>
          <button id="saveSettingsBtn" class="primary">Αποθήκευση ρυθμίσεων</button>
        </menu>
      </section>

      <hr />
      <menu>
        <button id="logoutBtn" type="button" class="ghost danger-btn">Αποσύνδεση</button>
      </menu>
    </form>
  </dialog>

  <!-- Modal: PIN (για editor & είσοδο) -->
  <dialog id="pinDialog">
    <form method="dialog" class="dialog-form">
      <h3 id="pinTitle">Κρυφός Editor</h3>
      <p id="pinMsg">Δώσε PIN για πρόσβαση.</p>
      <input id="pinInput" type="password" inputmode="numeric" maxlength="8" placeholder="PIN" required />
      <menu>
        <button value="cancel" class="ghost">Άκυρο</button>
        <button value="ok" class="primary">Συνέχεια</button>
      </menu>
    </form>
  </dialog>

  <!-- Modal: Editor (μαθήματα) -->
  <dialog id="editorDialog">
    <form method="dialog" class="dialog-form editor">
      <header class="dialog-header">
        <h3>Επεξεργασία</h3>
        <button value="cancel" class="ghost">Κλείσιμο</button>
      </header>

      <section>
        <h4>Στοιχεία Φοιτητή</h4>
        <label>Όνομα
          <input id="firstName" />
        </label>
        <label>Επώνυμο
          <input id="lastName" />
        </label>
        <label>Πανεπιστήμιο
          <input id="universityInput" />
        </label>
        <label>Αριθμός Μητρώου
          <input id="studentIdInput" />
        </label>
      </section>

      <section id="editorSemesters"></section>

      <section class="pin-section">
        <h4>PIN</h4>
        <p class="muted">Το PIN φυλάσσεται ως SHA-256 hash στη συσκευή.</p>
        <label>Νέο PIN
          <input id="newPin" type="password" inputmode="numeric" maxlength="8" placeholder="(προαιρετικό)" />
        </label>
      </section>

      <menu>
        <button id="addSemesterBtn" type="button" class="ghost">+ Προσθήκη Εξαμήνου</button>
        <button id="saveBtn" class="primary">Αποθήκευση</button>
      </menu>
    </form>
  </dialog>

  <!-- Chart.js (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- App -->
  <script src="app.js" type="module"></script>
</body>
</html>
